<!DOCTYPE html PUBLIC "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
  <meta http-equiv="Content-Type"
 content="text/html; charset=iso-8859-1">
  <meta name="GENERATOR"
 content="Mozilla/4.77 [en] (X11; U; Linux 2.2.19 i686) [Netscape]">
  <title>McStas 1.7: changes</title>
</head>
<body alink="#ff0000" bgcolor="#ffffff" link="#0000ef" text="#000000"
 vlink="#51188e">
<h3 style="text-align: center;">
Changes in version 1.7 (Mar 4, 2004)</h3>
<div style="text-align: center;">[ <a href="#Kernel">kernel</a> ][ <a
 href="#Run-time">run-time</a> ][ <a href="#Tools">tools</a> ][ <a
 href="#Components">components</a> ]<br>
</div>
<br>
<ul>
  <li><a name="Kernel"></a>Kernel (i.e. the 'mcstas' program)</li>
  <ul>
    <li>components may have a SHARE section, which is imported only
once per type<br>
of component. It has the same role as DECLARE, but only once.<br>
    </li>
    <li>the component files may have some %include inside '%{ }%' C
DECLARE or SHARE<br>
blocks. The files to include are searched locally, and then in the
library.<br>
If an extension is found, just the specified file is included, else
both <br>
.h and .c are embedded if the --no-runtime has not been specified.<br>
The instrument files can also embed external files, both in C blocks <br>
and in the instrument parts (DECLARE, etc...) as in previous releases.<br>
    </li>
    <li>The instrument and components may have char* setting
parameters. For<br>
instruments, their length is limited to 1024 chars.<br>
    </li>
    <li>The FINALLY section, that was executed at the end, has been
split into <br>
still the FINALLY, and a new SAVE section. This latter is executed<br>
at simulation end (just before the FINALLY), but also each time an<br>
intermediate save is required (e.g. a 'kill -USR2 &lt;pid&gt;' is used).<br>
    </li>
    <li>An instrument source file may contain EXTEND %{ }% C blocks
just after <br>
the usual AT...ROTATED.. keywords, to extend the behaviour of existing<br>
components, without touching their code. All local component variables
are <br>
available. This may for instance be used to add a new 'color' to
neutrons, <br>
i.e. assign a new characteristic variable to the neutron.<br>
    </li>
    <li>component instances in an instrument source file may be GROUPed
into <br>
exclusive assembly, i.e. only one component of the group will intercept<br>
neutron, the rest will be skipped. This is usefull for multi
monochromators<br>
multi detectors, multiple collimators, ... This is a kind if splitting.<br>
    </li>
    <li>McStas can now compile for Windows without troubles (if
lex/yacc files<br>
were generated elsewere, or using the flex/yacc for Windows)<br>
      <br>
    </li>
  </ul>
  <li><a name="Components_"></a>Components (in the lib directory)</li>
  <ul>
    <li>a new data directory contains neutron data tables<br>
    </li>
    <li>obsolete directory contains components that were renamed or old.<br>
    </li>
    <li>misc/Progress_bar component now exists, and may save data
regularly.<br>
    </li>
    <li>optics/Monochromator_curved can read reflectivity and
transmission tables<br>
    </li>
    <li>monitors/Monitor_nD can have automatic limits mode for either
all or <br>
selected monitored variables. It may also plot banana monitors for
mcdisplay<br>
and trigger intermediate savings for all monitors (same as USR2 sig.)<br>
Also, it may monitor something else than the intensity, e.g. the mean<br>
energy on a XY psd.<br>
    </li>
    <li>sources/Virtual_output can save all neutron events into a file<br>
(beware the size of the generated files !). Format may be text and
binary<br>
    </li>
    <li>sources/Virtual_input can read the files generated by
Virtual_output<br>
    </li>
    <li>optics/Guide_gravity can handle a 2D array of channels<br>
    </li>
    <li>optics/Filter_gen can read a table from a file and affect the
neutron beam<br>
(replaces the obsolete 'Flux_adapter'). It may act as a filter or a
source<br>
    </li>
    <li>samples: they now can all target towards any component, giving
its index <br>
(no need to compute target_x/y/z vector, use e.g. target_index=+1)<br>
    </li>
    <li>samples/Res_monitor, Powder1 and V_sample may now have a sphere
or box<br>
shape, and may focus to a circular or rectangular area<br>
      <br>
    </li>
  </ul>
  <li><a name="Run-time"></a>Run-time library (e.g. the instrument
program)</li>
  <ul>
    <li>A global gravitation handling is now available, by setting the
-g flag. BUGGY<br>
    </li>
    <li>many output formats are available for data. use the
--format="format"<br>
flag, e.g. --format="Scilab". The full list is displayed with<br>
the -h flag for the instrument program. <br>
example: <br>
mcrun test.instr --format="Matlab binary" -n 1e4<br>
will create a mcstas.m file. Launch Matlab and execute<br>
s=mcstas('plot') % will import data into s, and plot all detectors.<br>
Binary formats are handled by IDL, Matlab, Scilab.<br>
The present available format list is<br>
"McStas" "Scilab" "Matlab" "IDL" "XML" "HTML" <br>
The default format is McStas/PGPLOT, but may be specified globally using<br>
the MCSTAS_FORMAT environment variable<br>
    </li>
    <li>It is possible to save 3D data arrays, by calling the
DETECTOR_OUT_3D macro.<br>
(handled as 2D by mcplot)<br>
    </li>
    <li>The type of the 'number of events' array in monitors was
changed from int to<br>
double, to avoid overflow. Please update your home-made monitors.<br>
    </li>
    <li>many dedicated libraries are now available as shared code for
reading<br>
tables, handling data trees and monitors. These are C functions to be<br>
%included into components (see e.g. lib/monitors/Monitor_nD.comp)<br>
    </li>
    <li>The USR2 signal generates an intermediate save for all
monitors, during<br>
the simulation (execute the SAVE section). The USR1 still give
informations.<br>
    </li>
    <li>a new randvec_target_rect function now focuses on a rectangle<br>
(more efficient than former randvec_target_sphere=randvec_target_circle)</li>
  </ul>
  <li><a name="Tools"></a>Tools</li>
  <ul>
    <li>Matlab, Scilab and IDL may read directly McStas results if the
simulation<br>
was executed with the --format="..." option (see 'Run-time' changes)<br>
    </li>
    <li>mcplot, mcdisplay, mcgui are now less dependent on the
perl/pgplot installed<br>
versions.<br>
    </li>
    <li>mcplot can plot a single simulation data file<br>
    </li>
    <li>mcplot, mcresplot, mcdisplay can output gif, ps and ps color.
They also<br>
have integrated help (-h options), and may generate output files in a<br>
non interactive mode (read file, create output file, exit)<br>
    </li>
    <li>mcplot and mcdisplay work with Matlab, PGPLOT and Scilab
plotters (set with<br>
the MCSTAS_FORMAT default setting, or -pPLOTTER, or PGPLOT if not set)<br>
    </li>
    <li>mcrun can not currently generate scan results in other formats
than McStas<br>
    </li>
    <li>mcsats2vitess works now ok for converting a McStas component to
a Vitess one</li>
  </ul>
</ul>
<hr width="100%">
<center><i>Last modified Feb 24 2005 by E. Farhi<br>
</i></center>
</body>
</html>
