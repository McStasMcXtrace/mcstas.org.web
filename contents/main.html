<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>

<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1"></head><body><center>
<h1>
McStas - A neutron ray-trace simulation package</h1></center>
McStas is a general tool for simulating neutron scattering instruments
and experiments. It is actively supported by <a
href="http://www.fysik.dtu.dk/">DTU Physics</a>, <a
href="http://www.nbi.dk">NBI KU</a>, <a
href="http://www.europeanspallationsource.se">ESS</a>, <a href="http://www.psi.ch">PSI</a> and <a href="http://www.ill.eu">ILL</a>.&nbsp;
<table>
<tbody><tr>
<td>
<p><img src="/pics/v_sample_logo.gif" vspace="1" width="250" hspace="15" align="LEFT"><font size="-1">Simulated
scattering from a hollow-cylinder <a href="/download/components/3.4/samples/Incoherent.html">vanadium
sample</a>. </font></p></td><td>The plot shows the intensity of scattered neutrons (red is
highest intensity). The sample is at the center of the sphere with the
neutron beam coming from the left. Clearly seen is the shadowing effect
of the sample causing a lower intensity opposite the beam. Also seen is
the effect of the non-symmetric geometry of the sample, causing lower intensity
directly above and to the side of the sample.<br clear="BOTH"></td><td><img src="/pics/McStas-25-years.png" width="250"  hspace="15" align="RIGHT"></td></tr></tbody></table>
<br>
<br>
<hr width="100%">
<center>
<h2>
Recent news
</h2>
<hr>
<strong><font color="green">Migrating from McStas 2.x to 3.x? - <a href="https://github.com/McStasMcXtrace/McCode/wiki">Use the wiki-based guides<a></font></strong>
</center>
<hr>
<h2>November 1st, 2023: Hints to install McStasScript with McStas 3.4 on Linux</h2>
<p>Dear all,
<p>As you may have noticed, the McStas installers for Windows and
macOS now come with McStasScript embedded.
<p>To achieve the same functionality on Linux (e.g. Debian/Ubunutu),
you should perform these few steps
<ul>
  <li><code>pip install jupyterlab ipympl mcstasscript nodejs jupytext</code><br>(Please note any information on the location of your pip installation)
  <li>Find the file <code>configuration.yaml</code> within your pip installation, e.g.:<br><code>.local/lib/python3.10/site-packages/mcstasscript/configuration.yaml</code>
  <li>Edit that file to achieve the content<br>
  <pre>
other:
  characters_per_line: 85
paths:
  mcrun_path: /usr/bin
  mcstas_path: /usr/share/mcstas/3.4
  </pre>
</ul>
<p>Once these steps are performed you should be able to perform tasks like
<ul>
  <li>Use <code>mcstas-pygen</code> to generate a McStasScript <code>.py</code> version
  of an existing instrument:
  <pre>
~> mcstas-pygen BNL_H8.instr 
Warning: 'V_sample' is an obsolete component (not maintained).
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!!! WARNING: Your instrument file uses an input-parameter named !!!
!!!         "lambda" - which is a reserved word in Python       !!!
!!! As a workaround the variable has been named "Lambda" in     !!!
!!! the output python script.                                   !!!
!!! PLEASE consider renaming lambda->Lambda in the .instr file  !!!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
CFLAGS=
  </pre>
  <li>Use <code>jupytext</code> to convert from <code>.py</code> to <code>.ipynb</code> format:
  <pre>
~> jupytext --to ipynb BNL_H8_generated.py
[jupytext] Reading BNL_H8_generated.py in format py
[jupytext] Writing BNL_H8_generated.ipynb
  </pre>
  <li>Run <code>jupyter lab BNL_H8_generated.ipynb</code> to interact
  with your converted instrument in Jypyter Lab.
  <li>This should start a jupyter server and bring up a browser:<br>
  <a href="/pics/Jupyter1.png"><img src="/pics/Jupyter1.png" width=512></a>
  <li>Executing the cells should give you access to a rendering of the
  instrument and some output simulation data:<br>
  <a href="/pics/Jupyter2.png"><img src="/pics/Jupyter2.png"
  width=512></a><br>
  <a href="/pics/Jupyter3.png"><img src="/pics/Jupyter3.png" width=512></a>
</ul>
<hr>
<h2>September 23rd, 2023: McStas 3.4 Docker and Binder available</h2>
<p>Dear all,
<p>A Ubuntu 22.04 + McStas-3.4 + McStasScript image is now uploaded to
dockerhub. To run from your local podman / Docker / etc. installation,
execute a command along the lines of:
<p><code>podman run -p 8888:8888 docker.io/mccode/mcstas-3.4</code>
<p>+ follow instructions from podman/Docker
<p>You may also run the same container via binder, please connect via
this icon: <a href="https://mybinder.org/v2/gh/McStasMcXtrace/mcstas-binder/master?urlpath=desktop"><img
src="https://mybinder.org/badge_logo.svg" alt="Binder logo"></a>
<p>To start McStas, please issue the command <code>mcgui</code> from a terminal.
<hr>
<h2>September 21st, 2023: McStas 3.4 linux 'meta-packages' respun</h2>
<p>Dear all,
<p>A minor hickup was found with our Debian/Fedora metapackages that
  both had a dependence on <code>mcstas-mcpl-3.4</code> which is a
  non-existent package.
<p>Newly built, corrected meta-packages have been uploaded as
  replacement, so please re-attempt installation if you experienced
  issues earlier.
 <p>Also, please be aware that <code>mcpl</code> and <code>NCrystal</code> now come
 in separate, non-McStas related packages - and are not included in
   the "metapackage" on Fedora. To install them, simply execute<br>
<code>sudo dnf install mcpl ncrystal</code>
<p>Sorry for any inconvenience caused!
<hr>
<h2>September 19th, 2023: McStas 3.4 released</h2>
<p>Dear all, 
The new McStas release v. 3.4 "next-generation" is built and ready for download!

<p>McStas 3.4 is the fifth official release in the 3.x series, with a modernised code-generator and support for GPU acceleration on NVIDIA cards.

<p>3.4 is a 'major' update with notable changes, e.g. tighter
integration/interoperability with <a href="https://mads-bertelsen.github.io">McStasScript</a>, 
new grammar and further CMake-standardisation which will eventually
bring McStas to the conda-forge ecosystem. (And todaay, almost all
dependencies for McStas are brought by mamba/conda on macOS and
Windows.) Thanks to Thomas Kittelmann (ESS) for lots of help and footwork!

<p>Another notable change is that MCPL and NCrystal are now
distributed in stand-alone .deb / .rpm packages that are
McStas-release-independent, for convenience still available through the
packages.mccode.org repository. Please install using e.g.
<br><code>apt install mcpl ncrystal</code><br>
<br>(The MCPL and NCrystal codes have been submitted to the
Debian ecosystem by Synchrotron SOLEIL / Emmanuel Farhi / Roland Mas
and should make it to the next Debian Stable, the same procedure is
also under way for McStas.)

<p><strong>Thanks:</strong>
<br>Thanks to all members of the joint McStas-McXtrace team and input from our users via emails and GitHub issues alike!

<p>Download and installation instructions are available via our <a href="https://github.com/McStasMcXtrace/McCode/tree/master/INSTALL-McStas">GitHub INSTALL-doc pages</a>.

<p>Selected highlights from the releass are listed below. The full
list changes is also available at <a
href="https://mcstas.org/CHANGES_McStas">https://mcstas.org/CHANGES_McStas<a>.

<ul>
  <li>Fixes of issues from last 3.x release:
  <ul>
    <li>A number of issues from 3.3 were addressed, see the <a
  href="https://github.com/McStasMcXtrace/McCode/issues?q=is%3Aissue+is%3Aclosed+label%3Amcstas-3.3">relevant
    GitHub issues for details</a>
  </ul>
  <li>Installation:
  <ul>
    <li>As usual, our install docs are available on the <a href="https://github.com/McStasMcXtrace/McCode/tree/master/INSTALL-McStas">McCode GitHub pages</a>
    <li>The meta-packages for Debian/Ubuntu and RedHat/Centos/Fedora are named e.g.
    mcstas-suite-python-ng for 'next generation' for coexistance with the 2.x
    series packages. <br><strong>(!!! Please note that there will be no future
    2.x releases !!!)</strong>
  </ul>
  <li> Tools:
  <ul>
    <li>We are no longer supporting / distributing the Perl-based tool set as all functionality
    has finally been ported to the Python tool set (which has been default since v. 2.4)
    <li>mcrun now supports an set of "optimisation" switches to allow evaluating an instrument as
   "object function". Thanks to Emmanuel Farhi for working on
    this. Please use <br><code>mcrun --help</code><br> in your McStas terminal to learn
    about details of switches and parameters or see the <a href="https://mcstas.org/CHANGES_McStas">the changelog<a>
    for a full description.
    <li>McStas now ships with a "python-aware" code generator for
    generating "McStasScript" code, example:
    <br><code>mcstas-pygen Instrument.instr</code> generates the .py
    script <code>Instrument_generated.py</code><br>
    Using 'jupytext' this file may easily be converted to a notebook:
    <br><code>jupytext --to ipynb Instrument_generated.py</code>
    generates notebook file <code>Instrument_generated.ipynb</code><br>
    See <a href="https://github.com/PaNOSC-ViNYL/McStasScript">https://github.com/PaNOSC-ViNYL/McStasScript</a>
    and <a href="https://mads-bertelsen.github.io">https://mads-bertelsen.github.io</a> for more information on McStasScript.
    <li>McStasScript is included with McStas 3.4 on macOS and Windows and readily configured for use with
    McStas 3.4 and its embedded Python version. For sake of user convenience, Jupyterlab is also included
    on these platforms, use 'jupyter lab' from within the McStas 'environment' to work with a McStasScript
    notebook.
  </ul>
  <li> Components and Instruments:
  <ul>
    <li>In relation to the HighNESS project, the Wolter-optic components Conics_* have been given an
    overhaul by Mads Bertelsen. New related instrument WOFSANS is included with McStas 3.4.
    <li>Thanks to the work of Jos&eacute; Robledo (FZJ), we now have a better interface to the Small-Angle Scattering
    models from SASview, aka. SASmodels. Due to the big number of included models that each correspond
    to a McStas component (94 in total!), these are now found in the "sasmodels" folder of your McStas
    installation. Two example instruments are also included: Test_SasView_bcc_paracrystal_aniso.instr and
    Test_SasView_guinier.instr.
    <li>The strain-scanning instrument ILL_SALSA.instr was contributed by Daniel Lomholt Christensen,
    Uni Copenhagen and ILL.
  </ul>
  <li>Core simulation framework / code-generator:
  <ul>
    <li>As mentioned above, mcstas-pygen can generate a McStasScript
    notebook from you existing .instr file.
    <li>New "unit" grammar for defining physcical units for instrument
  parameters from Greg S. Tucker
    (ESS), example: <br><code>DEFINE INSTRUMENT template(lambda / "Aa" =
    2.36)</code><br> see <a href="https://mcstas.org/CHANGES_McStas">the changelog<a>
    for full description.
    <li>New <code>METADATA</code> grammar from Greg S. Tucker (ESS), can
    be used to attach verbatim code/information to one or more
    component instances. See <a href="https://mcstas.org/CHANGES_McStas">the changelog<a>
    for full description.
  </ul>
  <li><strong>START your migration to 3.x:</strong>
  <ul>
    <li>Following the release of 3.4, we will no longer systematically be releasing updates to the
    2.x series.
    <li>The Wiki has a dedicated section on McStas 2.x -> McStas 3.x
    conversion. Please use it!
    <li>If you are in trouble converting your instrument, please write us a GitHub issue or an email to mcstas-users@mcstas.org
  </ul>
</ul>
We hope you will enjoy this new release!!!
<hr>
<h2>March 31st, 2023: McStas 3.3 released</h2>
<p>Dear all, 
The new McStas release v. 3.3 "next-generation" is built and ready for download!

<p>McStas 3.3 is the fourth official release in the 3.x series, with a modernised code-generator and support for GPU acceleration on NVIDIA cards.

<p>3.3 could have been considered a 'minor' update, but new built-in
support for NeXus on all platforms and new <code>SEARCH</code> grammar warrant the .x increment.

<p><strong>Thanks:</strong>
<br>Thanks to all members of the joint McStas-McXtrace team and input from our users via emails and GitHub issues alike!

<p>Download and installation instructions are available via our <a href="https://github.com/McStasMcXtrace/McCode/tree/master/INSTALL-McStas">GitHub INSTALL-doc pages</a>.

<p>Selected highlights from the releass are listed below. The full
list changes is also available at <a href="https://mcstas.org/CHANGES_McStas">https://mcstas.org/CHANGES_McStas<a>.

<p><b>If you didn't start already, please start your migration to 3.x:</b>
<ul>
  <li>The Wiki has a dedicated section on <a href="https://github.com/McStasMcXtrace/McCode/wiki#migrating-from-mcstas-2x-to-3x-and-mcxtrace-1x-to-3x">McStas 2.x -> McStas 3.x conversion</a> that includes:
  <ul>
    <li><a href="https://github.com/McStasMcXtrace/McCode/wiki/Overview-of-differences-in-%22classic-McStas-McXtrace%22-and-the-3.x-versions">An overview of differences</a>
    <li><a href="https://github.com/McStasMcXtrace/McCode/wiki/McStas-McXtrace-3-and-GPU-terminology-%28table%29">A nomenclature list containing short descriptions of new concepts and important keywords in McStas 3.x</a> and OpenACC / CUDA code in general.
    <li><a href="https://github.com/McStasMcXtrace/McCode/wiki/Overview-of-differences-in-%22classic-McStas-McXtrace%22-and-the-3.x-versions">A document outlining the most importand differences between 2.x and 3.x.</a>
    <li><a href="https://github.com/McStasMcXtrace/McCode/wiki/HOWTO%3A-Modifying-a-McStas-2-instrument-for-use-under-McStas-3">A guide for 2.x -> 3.x instrument conversion.</a>
    <li><a href="https://github.com/McStasMcXtrace/McCode/wiki/HOWTO%3A-Modifying-a-McStas-2-component-for-use-under-McStas-3">A guide for 2.x -> 3.x component conversion.</a>
  </ul>
</ul>  
 - If you are still in trouble, please write us a GitHub issue or an email to <a href="mailto:mcstas-users@mcstas.org">mcstas-users@mcstas.org</a>

<p><b>Fixes of issues from last 3.x release:</b><br>
A number of issues from 3.2 were addressed, see the relevant GitHub issues for details:<br>
<a href="https://github.com/McStasMcXtrace/McCode/issues?q=is%3Aissue+is%3Aclosed+label%3Amcstas-3.2">3.2 issue list</a><br>

<p><strong>Release highlights</strong><br>
<ul>
  <li>Installation and core packaging:
  <ul>
    <li>McStas 3.3 comes with embedded NeXus support on macOS and on Debian/Ubuntu NeXus is pulled
    as a package dependency. On Windows, please install NeXus from the extras/ folder alongside
    your McStas bundle.
    <li>The build process for macOS has been overhauled and is now performed with the embedded
    conda environment. Further, the macOS builds should be more robust wrt. added, surrounding
    non-standard Python environments on the target machine.
  </ul>

  <li>GPU support:
  <ul>
    <li>McStas 3.3 enables most components and instruments on GPU. A very limited instruments using
    the "scatter logger" mechanism are still only available on 2.x and key components (e.g. Union
    and NCrystal) compute only on CPU.
  </ul>
  
  <ll>Tools:
  <ul>
    <li><code>mcrun</code> now automatically adds NeXus support to your binary if <code>--format=NeXus</code> is given on the
  commandline (or if <code>DEPENDENCY " @NEXUSFLAGS@ "</code> is
    included in your instrument or component file).
    <li>The new input flag <code>--IDF</code> will run an IDF generator (i.e. mcdisplay-mantid) prior to performing
    a NeXus-based simulation, i.e. for "one-click" support of output in Mantid-compatible NeXus
    format with an embedded IDF. Please consult the naming-conventions for <code>sourceMantid</code>, <code>sampleMantid</code>
    and <code>nD_Mantid_xx</code> found in <a href="https://github.com/McStasMcXtrace/McCode/wiki/McStas-and-Mantid#mcstas-mantid-workflow">https://github.com/McStasMcXtrace/McCode/wiki/McStas-and-Mantid#mcstas-mantid-workflow</a>
    to succesfully generate your IDF. Please also inspire from the example instruments in the <code>Mantid</code>
    category, see <code>mcgui -> File -> New from template -> Mantid</code> .
    <li><code>mcrun</code> now forwards the <code>-I</code> input to the code-generator, which allows you to add a chosen folder
    with extra components etc. to your search path. Setting the <code>-I</code> flag implies recompilation (<code>-c</code>).
    (Please also note the related <code>SEARCH</code> grammar below which allows working on the component search
    path directly via the instrument or component grammar.)
    <li>The <code>mcgui</code> run dialogue now allows to directly specify <code>--format=NeXus</code> and <code>--format=NeXus --IDF</code> when starting a simulation.
    <li><code>mcdisplay-mantid</code> has been given a good overhaul and now works properly with all of the supported
    mantid-event-detector geometries of <code>Monitor_nD</code>: rectangular, cylindrical/banana and OFF-file based.
    Thanks to Torben R. Nielsen and Celine Durniak (ESS) for repeated testing.
    <li><code>mcplot</code> (<code>-pyqtgraph</code>) and numpy related bug was quickly spotted
    and ironed out with the help of by Rose Robledo FZJ.
  </ul>
  <li>Components and Instruments:
  <ul>
    <li><code>FZP_simple model.comp</code> of Fresnel Zone-Plate (phenomenologic/closed-form thin-plate approximation) added
    along with test instrument <code>Test_FZP_simple.instr</code>, work by Anders Komar Ravn (NBI), and Erik B Knudsen
    (previously DTU, now Copenhagen Atomics)
    <li><code>Test_Monochromators.instr</code> has been updated to include <code>NCrystal_sample</code> as a monochromator, plus
    includes multiple ways of parametrizing Single_crystal lattice
    orientation. (Please note that NCrystal support is still not complete on Windows.)
    <li>The 3 example <code>ConicTracer</code> interface-component codes <code>Conics_EH.comp, Conics_PH.comp, Conics_PP.comp</code>
    have been updated to allow specifying non-equidistant radii of the nested optical shells. Please
    use <code>vector radii={a,b,c,d,e}</code> or initialization via an instrument-based array and use a compatible
    setting of nshells.
    <li>The <code>Elliptical_guide_gravity.comp</code> will now complain if you are using arrays for specifying varied coating
    without setting the <code>nSegments</code> input.
    <li>The multi-v-cavity support from the McStas 2.x version of <code>Pol_guide_vmirror.comp</code> has been ported to 3.3.
    Thanks to Damian Rodriguez and Hal Lee (ESS) for interactions on this component.
    <li>By popular demand, certain characteristics of the <code>ESS_butterfly</code> component may be modified using
    compile-time re-definition. Defaults are
    <code>ESS_SOURCE_DURATION0=2.857e-3</code> s,
  <code>ESS_SOURCE_FREQUENCY 14</code> Hz,
    <code>ESS_SOURCE_POWER 5</code> MW. (Use e.g. <code>mcrun --D1=ESS_SOURCE_DURATION=1.0e-3</code> to simulate a 1 ms pulse.)
    <li>Similarly, the precession-algorithm constants of <code>pol-lib</code> may also be redefined at compile-time,
    defaults are: <code>MCMAGNET_STACKSIZE=12</code>,
  <code>mc_pol_angular_accuracy=(1.0*DEG2RAD)</code> deg,
  <code>mc_pol_initial_timestep=1e-5</code> s.
  </ul>
  <li>Core simulation framework / code-generator:
  <ul>
    <li>A new syntax called <code>SEARCH</code> has been added to the grammar, allowing users to run append a directory
    to the mcstas search path when looking for components. The syntax may be given in the
    instrument- or component-header directly after a <code>SHELL</code> token and before the <code>DEPENDENCY</code>, <code>DECLARE</code>
    tokens, available in two variants:
    <ul>
      <li><code>SEARCH "/the/path/to/add/" </code>
      <li><code>SEARCH SHELL "the_executable --and --some --options"
      </code>
    </ul>
    But you may also apply the same two <code>SEARCH</code> forms in connection with a component instance in <code>TRACE</code>, e.g.:<br>
    <code>TRACE</code></br>
    <code>...</code></br>
    <code>SEARCH SHELL "readout-config --show compdir"</code></br>
    <code>COMPONENT readout = Readout(ring="RING", fen="FEN", tube="TUBE", a="left", b="right", ...)</code></br>
    <code>AT (0, 0, 0) ABSOLUTE</code></br>
    <code>...</code></br>
    <li>Thanks to Gregory S. Tucker (ESS) for contributing this
    grammar enhancement!
  </ul>
  
  <li>Libraries and other runtime code:
  <ul>
    <li>The <code>(r-)interoff-lib.c</code> family of codes have again received a couple of updates, thanks to McStas user
    Richard Wagner (ILL).
    <li><code>NCrystal</code> library version 3.5.1 from T. Kittelmann (ESS) and X.X. Cai (CSNS), distributed
    with McStas on Unix platforms only. (Cross-compiles for Windows, but still needs work
    for "production" availability.)
    <li><code>MCPL</code> library from the same authors included at v. 1.6.1
  </ul>
  
  <li>Platforms:
  <ul>
    <li>We still support 64bit Windows 10/11 on Intel, three most recent 64bit macOS (11 Big Sur -> 13 Ventura)
    on both Intel and Apple Silicon/M-series processors. Debian-based distros on Intel and Arm, Fedora on Intel.
    <li>On macOS and Windows we bundle a Mambaforge Python with the
    installation.
  </ul>
</ul>

<p>Our Docker and binder containers will be updated within the
following weeks.

<p>We hope you will enjoy this new release!!!

<hr>
<p><b>Previous news items: </b><a href="/news/2022.html">2022</a>, <a href="/news/2021.html">2021</a>,<a href="/news/2020.html">2020</a>,<a href="/news/2019.html">2019</a>, <a href="/news/2018.html">2018</a>, <a
href="/news/2017.html">2017</a>, <a href="/news/2016.html">2016</a>,
<a href="/news/2015.html">2015</a>, <a
href="/news/2014.html">2014</a>, <a href="/news/2013.html">2013</a>,
<a href="/news/2012.html">2012</a>, <a
href="/news/2011.html">2011</a>, </b><a
href="/news/2010.html">2010</a>, <a href="/news/2009.html">2009</a>,
<a href="/news/2008.html">2008</a>, <a
href="/news/2007.html">2007</a>, <a href="/news/2006.html">2006</a>,
<a href="/news/2005.html">2005</a>, <a
href="/news/2004.html">2004</a>, <a href="/news/2003.html">2003</a>, <a href="/news/2002.html">2002</a>, <a href="/news/2001.html">2001</a>, <a href="/news/2000.html">2000</a>, <a href="/news/1999.html">1999</a>,
<a href="/news/1998.html">1998</a>.

</p></body></html>
