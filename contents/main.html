<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>

<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1"></head><body><center>
<h1>
McStas - A neutron ray-trace simulation package</h1></center>
McStas is a general tool for simulating neutron scattering instruments
and experiments. It is actively supported by <a
href="http://www.fysik.dtu.dk/">DTU Physics</a>, <a
href="http://www.nbi.dk">NBI KU</a>, <a
href="http://www.europeanspallationsource.se">ESS</a>, <a href="http://www.psi.ch">PSI</a> and <a href="http://www.ill.eu">ILL</a>.&nbsp;
<table>
<tbody><tr>
<td>
<p><img src="/pics/v_sample_logo.gif" vspace="1" width="300" height="143" hspace="15" align="LEFT"><font size="-1">Simulated
scattering from a hollow-cylinder <a href="/documentation/mcdoc/components/samples/V_sample.html">vanadium
sample</a>. </font></p></td><td>The plot shows the intensity of scattered neutrons (red is
highest intensity). The sample is at the center of the sphere with the
neutron beam coming from the left. Clearly seen is the shadowing effect
of the sample causing a lower intensity opposite the beam. Also seen is
the effect of the non-symmetric geometry of the sample, causing lower intensity
directly above and to the side of the sample.<br clear="BOTH"></td></tr></tbody></table>
<br>
<br>
<hr width="100%">
<center>
<h2>
Recent news
</h2>
<hr>
<strong><font color="green">Migrating from McStas 2.x to 3.x? - <a href="https://github.com/McStasMcXtrace/McCode/wiki">Use the wiki-based guides<a></font></strong>
</center>
<hr>
<h2>December 12th, 2022: McStas 2.7.2 and McStas 3.2 released</h2>
<p>Dear all,
A new <b>PAIR</b> of releases of McStas:
<ul>
  <li>McStas "classic" v. 2.7.2
  <li>McStas "next-generation", v. 3.2
</ul>
Are both built and ready for download!

<p>Download and installation instructions are available via our <a href="https://github.com/McStasMcXtrace/McCode/tree/master/INSTALL-McStas">GitHub INSTALL-doc pages</a>.

<p>Selected highligts from the releases are listed below. The full list
of changes for both releases is also available at <a href="https://mcstas.org/CHANGES_McStas">https://mcstas.org/CHANGES_McStas<a>.

<p><b>Please start your migration to 3.x:</b>
<ul>
  <li>McStas 2.7.2 is a "last update" to the 2.x series, sharing a subset of tool features with McStas 3.2.
  <li>The Wiki has a dedicated section on <a href="https://github.com/McStasMcXtrace/McCode/wiki#migrating-from-mcstas-2x-to-3x-and-mcxtrace-1x-to-3x">McStas 2.x -> McStas 3.x conversion</a> that includes:
  <ul>
    <li><a href="https://github.com/McStasMcXtrace/McCode/wiki/Overview-of-differences-in-%22classic-McStas-McXtrace%22-and-the-3.x-versions">An overvies of differences</a>
    <li><a href="https://github.com/McStasMcXtrace/McCode/wiki/McStas-McXtrace-3-and-GPU-terminology-%28table%29">A nomenclature list containing short descriptions of new concepts and important keywords in McStas 3.x</a> and OpenACC / CUDA code in general.
    <li><a href="https://github.com/McStasMcXtrace/McCode/wiki/Overview-of-differences-in-%22classic-McStas-McXtrace%22-and-the-3.x-versions">A document outlining the most importand differences between 2.x and 3.x.</a>
    <li><a href="https://github.com/McStasMcXtrace/McCode/wiki/HOWTO%3A-Modifying-a-McStas-2-instrument-for-use-under-McStas-3">A guide for 2.x -> 3.x instrument conversion.</a>
    <li><a href="https://github.com/McStasMcXtrace/McCode/wiki/HOWTO%3A-Modifying-a-McStas-2-component-for-use-under-McStas-3">A guide for 2.x -> 3.x component conversion.</a>
  </ul>
</ul>  
 - If you are still in trouble, please write us a GitHub issue or an email to <a href="mailto:mcstas-users@mcstas.org">mcstas-users@mcstas.org</a>

<p><b>Fixes of issues from last releases:</b><br>
A good number of issues from the earlier 2.7.1 and 3.1 releases were addressed, see the relevant GitHub issues for details:<br>
<a
href="https://github.com/McStasMcXtrace/McCode/issues?q=is%3Aissue+is%3Aclosed+label%3Amcstas-2.7.1">Full
2.7.1 issue list</a><br>
<a
href="https://github.com/McStasMcXtrace/McCode/issues?q=is%3Aissue+is%3Aclosed+label%3Amcstas-3.1">Full
3.1 issue list</a><br>

<p><b>Release highligts</b><br>
(!!<b>3.2 only</b> denotes features or improvements that are 3.2 specific!!)
<ul>
  <li><b>Documentation & guides:</b>
  <ul>
    <li><b>3.2 only:</b> All 3.2 component and instrument headers have been given an overhaul and should
   render correctly in mcdoc / your browser.
    <li>The component pages now include an extra column in the parameter-table. When filling in
   this column with wanted values, plus filling the entry-boxes for AT, ROTATED and instance
   name, pressing "Generate" will put a code-snipet for your component instance directly on
   your computer clipboard, for easy transfer to the mcgui editor or any other editor of choice!
    <li>mcdoc has been made "less picky" wrt. component and instrument structure for a more robust
   experience.
    <li>mcgui has a new "Docs" button for easier access to the generated mcdoc pages (that give easy
   access to components, instruments, manuals, datafiles and more.
  </ul>
  <li><b>Interoperability with other codes:</b>
  <ul>
    <li>We have worked on the interfaces with MCPL (v. 1.6.1 included)
    and NCrystal (v. 3.5.1 included) and a mechanism was developed
    to automatically detect their location using the mcpl-config and ncrystal-config utils.
    In practice this happens prior/during to the code-generation step, see below under mcrun.
    Thanks to Thomas Kittelmann (ESS) for your help in this area.
  </ul>
  <li><b>Tools:</b>
  <ul>
    <li>mcrun has a new solution to support 3 new keywords CMD(), ENV() and GETPATH() through the
   DEPENDENCY line as collected by the code-generator. (see CHANGES
    doc for more details)
    <li>As mentioned above, mcdoc has been made "less picky" wrt. component
    and instrument structure and enriched with JavaScript for easy
    transfer of information to you editor.
    <li>mcplot(-pyqtgraph) has received a nice update with an infobar at the bottom of the window.
    The infobar is updated with coordinates of the cursor on the active plot, meaning that you
    can easily determine the coordinates of e.g. a peak. The code has also received a number of
    bugfixes relating to colorbars, the order of monitor output in overviews etc.
    Thanks to Tobias Weber (ILL) for your work on mcplot.
    <li><b>3.2 only:</b> The new mcdisplay-cad variant has come along, and is currently included in the form of a
    technology-preview. The code uses the Python module cadquery (https://github.com/CadQuery/cadquery)
    and is able to write e.g. STEP or STL output. For now, resolving the required dependencies is
    left to the user, but we foresee that this tool will mature over the coming releases.
    Thanks to Greg Tyler (ESS) for contributing this tool.
  </ul>
  <li><b>Components and Instruments:</b>
  <ul>
    <li>The Union framework is now considered a fully "official" part of McStas and is hence now found
    in the $MCSTAS/union folder. In McStas 3.2 Union_master is a still a NOACC component when running on GPU
    (i.e. performs its calculations on CPU in FUNNEL mode). We expect Union_master to receive
    full GPU suport within 2023. The NCrystal_process.comp is back in
    Union on 3.2 - will work only in a NOACC/CPU COMPONENT setting.
    <li>By popular demand, the ConicTracer code for simulating Wolter optics from Boris Khaykovich et. al. (MIT)
    has been included. The main "library" code is conic.h found in $MCSTAS/share and is used from
    3 different example Wolter optic components: Conics_EH.comp, Conics_PH.comp, Conics_PP.comp.
    The illustrate how to mplement Elliptic-Hyperbolic, Parabolic-Hyperbolic and Parabolic-Parabolic
    Wolter mirrors, and two of these are used in the
    Test_Conics_pairs.instr instrument.
    <li><b>3.2 only:</b> Most of the standard monitors will now fill in their own "instance name" as filename in case
    a filename was not defined. A small but very useful convenience.
    <li>Source_div_quasi.comp allows to sample source phase-space using Halton-sequences, which proves
    to be a very effective way to ensure an evenly distributed phase space region of interest, e.g.
    for imaging/SANS settings where a very low-divergent beam is relevant. This contribution is from 
    Mads Carlsen and Erik B. Knudsen (DTU) and was originally
    developed for McXtrace.
    <li>PSD_Pol_monitor.comp measures (local) polarisation over the (x,y) cross-section of a beam. Contributed
    by Alexander Backs (LU/ESS).
    <li><b>3.2 only:</b> Single_crystal_inelastic.comp (NOACC), Single_magnetic_crystal.comp (NOACC), SANS_benchmark2.comp and
    Guide_multichannel are now all available in the McStas 3
    series. Also, the Fermi_chop2a.comp and Vertical_T0a.comp chopppers from Garrett Granroth (SNS) have received
    a GPU-oriented update.
</ul>
  <li><b>Core and libs:</b>
  <ul>
    <li><b>3.2 only:</b>Previously, any component present in a McStas instrument would trigger the transformation of
    every neutron to its local coordinate system, even in the case of an Arm() (empty TRACE) without
    an EXTEND block. We now instead detect components with an empty TRACE that have no EXTEND block
    and are able to completely skip these in the calculation. This results in a speedup in case of
    instruments with many "empty" components, such as big Union assemblies.
    Thanks to Mads Bertelsen (ESS) for investigating the problem and finding a good solution.
    <li><b>3.2 only:</b> A new syntax called SHELL has been added to the grammar, allowing users to run a system command
    prior to code-generation. This may for instance be used to generate an instrument-snippet that
    you may %include in the instrument (think for-loops of an assembly of identical components).
    One could also imagine compilation of a needed library, wget of a data file etc.
    The synax is SHELL "command-to-execute" and it should be placed directly after a DEPENDENCY line
    within an instrument or component. We expect that applications and examples will come in the
    next couple of releases.
    <li><b>3.2 only:</b>Components may from McStas 3.2 request USERVARS that become part of the particle struct.
    (For the time being only in the form of basic C types like double, int etc. and corresponding
    arrays / pointers.) This will mean that e.g. the optimisations in Single_crystal and PowderN
    in SPLIT scenarios can be introduced also in GPU settings.
    The first component to make use of this mechanism is
    Res_monitor.comp as used in Test_TasReso.instr.
    <li>The (r-)interoff-lib.c family of codes have received multiple updates, thanks to McStas users
    Kyle Grammer (ORNL) and Gaetano Mangiapia (HZH):
    <ul>
      <li>The intersection routines now work correctly with gravity
      <li>The r-interoff-lib (and the related Guide_anyshape_r component) now support specifying
      a "full" reflectivity curve pr. OFF face, columns of m, alpha and W values should be
      added in this order to the OFF face.
    </ul>
    <li>A flaw was spotted in our NeXus implementation in the case of event lists: A small chunk-size
   of (1,6) was used, leading to slow I/O and lots of
    size-overhead. Thanks to Simon Heybrock (ESS) for spotting this!
    <li>A correction to ref-lib.c was recieved from Gaetano Mangiapia (HZH), allowing closer
    correspondance between simulated and measured mirror-reflectivities.
  </ul>
</ul>

<p><b>Platforms:</b><br>
We still support 64bit Windows 10/11 on Intel, all recent 64bit macOS
including 11.x - 13.x Monterey on both Intel and Apple Silicon/M1
processors. Debian/Ubuntu-based distros on Intel and Arm, our
RPM-based distro is Fedora on Intel. (Official support for CentOS has
been dropped, but you should be able to "roll your own" from the src packages.)

<p>Our Docker and binder containers will be updated within the
following weeks.

<p>We hope you will enjoy these new releases!!!
<hr>
<h2>November 1st, 2022: macOS 13 Ventura issues</h2>
<p>Dear all,
<p>If you upgrade to macOS 13 Ventura (intel/x86_64), your already installed Python
tools of McStas 2.7.1 / 3.1 and /Application bundles may not work after the upgrade.
<p>A workaround is to:
<ul>
  <li>In a terminal, start your "McStas shell"
  (e.g. run mcstas-3.1-environment, /Applications/McStas-3.1-environment.command or
  /Applications/McStas-3.1.app/Contents/Resources/mcstas/3.1/environment)
  <li>Issue the command <pre>export PATH=$MCSTAS/miniconda3/bin:$PATH</pre>
  <li>Next, you may issue the mcgui command<pre>mcgui</pre>
</ul>
<p>New releases 2.7.2 and 3.2 are in preparation and should be
released during November or December.
<hr>
<h2>November 1st, 2022: Python 3.10 / pyqtgraph issues in current releases.</h2>
<p>Dear all,
<p>Several users have reported "yet another Python issue" that arise
in current releases of McStas (2.7.1 / 3.1). After following the
advice from September 23rd to replace mcgui/viewclasses.py and
mccodelib/pqtgfrontend.py, mcplot-pyqtgraph fails with
<pre>
mcplot error: scale(self): too many arguments
Traceback (most recent call last):
File "C:\mcstas-2.7.1\lib\tools\Python\mcplot\pyqtgraph\mcplot.py", line 67, in 
main(args)
File "C:\mcstas-2.7.1\lib\tools\Python\mcplot\pyqtgraph\mcplot.py", line 57, in main
raise e
File "C:\mcstas-2.7.1\lib\tools\Python\mcplot\pyqtgraph\mcplot.py", line 51, in main
plotter.runplot()
File "C:\mcstas-2.7.1\lib\tools\Python\mcplot\pyqtgraph....\mccodelib\pqtgfrontend.py", line 62, in runplot
plot_node(node, self.plot_func, plt_layout, viewmodel)
File "C:\mcstas-2.7.1\lib\tools\Python\mcplot\pyqtgraph....\mccodelib\pqtgfrontend.py", line 144, in plot_node
viewbox_lst.append(add_plot(layout, node, plot_func, i, n, viewmodel))
File "C:\mcstas-2.7.1\lib\tools\Python\mcplot\pyqtgraph....\mccodelib\pqtgfrontend.py", line 382, in add_plot
view_box, plt_itm = plot_node_func(node, i, plt, options)
File "C:\mcstas-2.7.1\lib\tools\Python\mcplot\pyqtgraph\plotfuncs.py", line 33, in plot
view_box, lyt = plot_Data2D(data, plt, log=opts['log'], legend=opts['legend'], icolormap=opts['icolormap'],
File "C:\mcstas-2.7.1\lib\tools\Python\mcplot\pyqtgraph\plotfuncs.py", line 203, in plot_Data2D
img.scale(dx,dy)
TypeError: scale(self): too many arguments'
</pre>
To fix this issue, please replace your
<ul>
  <li>$MCSTAS/tools/Python/mcplot/pyqtgraph/plotfuncs.py with <a href="https://raw.githubusercontent.com/McStasMcXtrace/McCode/54c348b02fb20c6182866edd8ecd10096f7c25db/tools/Python/mcplot/pyqtgraph/plotfuncs.py">this new version</a>
</ul>
<p>New releases 2.7.2 and 3.2 are in preparation and should be
released during November or December.
<hr>
<h2>September 23rd, 2022: Python 3.10 issues in current releases.</h2>
<p>Dear all,
<p>We have recently become aware of a couple of issues that arise with all current releases of McStas (2.7.1 / 3.1)
<p>On system with the newest Python versions (3.10 and beyond) you may experience that 
<ul>
  <li> mcgui fails on execution, see <a href="https://github.com/McStasMcXtrace/McCode/issues/1270">https://github.com/McStasMcXtrace/McCode/issues/1270</a> for details
  <li> mcplot fails on execution, see <a href="https://github.com/McStasMcXtrace/McCode/issues/1281">https://github.com/McStasMcXtrace/McCode/issues/1281</a> for details
</ul>
<p>In case you experience these problems you may replace the following files within your installation folder:
<ul>
  <li>$MCSTAS/tools/Python/mcgui/viewclasses.py - please replace by <a
  href="https://raw.githubusercontent.com/McStasMcXtrace/McCode/d30a2567dd77d0e1880c2020cc17ef6c5cdf3078/tools/Python/mcgui/viewclasses.py">this new version</a>
  <li>$MCSTAS/tools/Python/mccodelib/pqtgfrontend.py - please replace
  by <a
  href="https://raw.githubusercontent.com/McStasMcXtrace/McCode/54c348b02fb20c6182866edd8ecd10096f7c25db/tools/Python/mccodelib/pqtgfrontend.py">this
  new version</a>
</ul>
<p>New stable releases of McStas should be released during November/December this year.

<p>Best and sorry for the inconvenience,

<p>Peter Willendrup

<hr>
<h2>August 20th, 2022: Preview of ICNS 2022 presentation available.</h2>
<p>On behalf of the McStas team, <b>Peter Willendrup</b> is giving an
<a href="https://www.icns2022.org">ICNS2022</a> presentation, entitled:
<p><b>Speeding up legacy: <i>GPU-accelerating the McStas instrument simulation code using OpenACC</i></b>.
<p>
<b><center>Abstract</center></b>
<p style="padding: 10px; border: 2px solid gray;">The McStas neutron ray-tracing simulation package is a versatile tool
for producing accurate simulations of neutron scattering instruments
at reactors, short- and long-pulsed spallation sources such as the
European Spallation Source.<br>McStas is extensively used for design and optimization of instruments, virtual experiments, data analysis and user training. McStas was founded as an scientific, open-source collaborative code in 1997 and thus celebrates 25 years of service to the neutron community
in 2022.<br>The contribution presents the project at its current
state, with emphasis on recent modernisation-efforts and
GPU-acceleration. Using the OpenACC precompiler-mechanism, McStas and
its X-ray counterpart McXtrace have received speedups in the range of
10-600 depending on problem size and model complextiy.<br>By a
detailed walk-through of a selected instrument example including the
utilised components, we will illustrate the few simple steps users
should carry out to port their existing instrument-models.
</p>
<p>
<a href="https://www.youtube.com/watch?v=Ou7dAHhJRn0"><img height="200px" src="/pics/ICNS_slide1.png"><img height="100px" src="/pics/Peter_ICNS.png"></a>
<p>The video has been pre-recorded and is now available at <a
href="http://media.mcstas.org/PWillendrup_ICNS_2022_McStas_GPU.mp4">media.mcstas.org</a>
or on <a href="https://www.youtube.com/watch?v=Ou7dAHhJRn0">YouTube</a>
<hr>
<h2>May 14th, 2022: Neutron-optics and McStas/Union related Post Doc position at PSI:</h2>
<p>Dear all,

<P>An interesting Post Doc position is available within the Neutron Optics and Scientific Computing Group at PSI:<br>
<a href="https://www.psi.ch/en/pa/job-opportunities/51272-post-doc-in-neutron-instrumentation">https://www.psi.ch/en/pa/job-opportunities/51272-post-doc-in-neutron-instrumentation</a>

<p>A central part of the position is expanding features of the McStas Union by adding support for reflectivity (and potentially refraction).

<p>Main tasks are:
<ul>
  <li>Simulation and code development for neutron optics
  <li>Extend the Monte-Carlo Ray-tracing software McStas
  <li>Design an advanced signal-to-noice enhancing neutron optics
  <li>Conceptualize tutorials for users
  <li>Participate in neutron scattering experiments
</ul>
<p>For more information please refer to the link below or contact
Dr. Christine Klauser <a href="mailto:christine.klauser@psi.ch">&lt;christine.klauser@psi.ch&gt;</a>

<p>Best,<br>
Peter Willendrup
<hr>
<h2>February 18th, 2022: New ready-to-run McStas box in a browser</h2>
<p>We are happy to provide a <a href="https://github.com/McStasMcXtrace/mcstas-binder">ready-to-run system with McStas pre-installed</a>. 
It typically pulls-out an 8-cores computer running at Binder, for free, with both McStas 2.x and 3.x (with MPI multi-core support but no GPU).
Perfect for running McStas from anywhere, for training/schools/workshops.
<p>
Start it in a single click here: <a href="https://mybinder.org/v2/gh/McStasMcXtrace/mcstas-binder/master?urlpath=desktop"><img src="https://mybinder.org/badge_logo.svg"></a>
<p>(Please note that load-time can be a couple of minutes.)
<p><a target=_blank href="/pics/mcstas-binder.png"><img width=350 alt="screenshot" src="/pics/mcstas-binder.png"></a>
<p><h3>Update:</h3>
The above docker image has been pushed to dockerhub and can also be
run locally at your machine using docker:
<ul>
  <li>Install docker (if needed)
  <li><pre>docker run -p 8888:8888 docker.io/mccode/mcstas-2.7.1-3.1:1.0</pre>
  <li>Connect your browser to the URL communicated by the docker command
</ul>
<hr>
<p><b>Previous news items: </b><a href="/news/2021.html">2021</a>,<a href="/news/2020.html">2020</a>,<a href="/news/2019.html">2019</a>, <a href="/news/2018.html">2018</a>, <a
href="/news/2017.html">2017</a>, <a href="/news/2016.html">2016</a>,
<a href="/news/2015.html">2015</a>, <a
href="/news/2014.html">2014</a>, <a href="/news/2013.html">2013</a>,
<a href="/news/2012.html">2012</a>, <a
href="/news/2011.html">2011</a>, </b><a
href="/news/2010.html">2010</a>, <a href="/news/2009.html">2009</a>,
<a href="/news/2008.html">2008</a>, <a
href="/news/2007.html">2007</a>, <a href="/news/2006.html">2006</a>,
<a href="/news/2005.html">2005</a>, <a
href="/news/2004.html">2004</a>, <a href="/news/2003.html">2003</a>, <a href="/news/2002.html">2002</a>, <a href="/news/2001.html">2001</a>, <a href="/news/2000.html">2000</a>, <a href="/news/1999.html">1999</a>,
<a href="/news/1998.html">1998</a>.

</p></body></html>
