<html><head>
<title>Compiling McStas simulations</title>
<LINK REV="made" HREF="mailto:kristian.nielsen@risoe.dk">
</head>

<body>

<h1>Compiling McStas simulations</h1>

<P>
Choosing the right compiler and compilation options can make a huge difference
in the performance of the simulations generated by McStas. Experiments show
that using the HP C compiler with the right options generates code that runs
more than twice as fast as code generated using GCC. Using the wrong options
causes the HP compiler to generate worse code than GCC!

<P>
The performance of McStas has been tested on two systems. One, fys-hp-2, is an
HPPA 9000/780 machine running HP-UX 10.20. The other, elm-298, is a 300MHz
Pentium II PC running Linux 2.0.

<P>
On the HP machine, the best performance was found with the following
compilation options:
<PRE>
  cc -Aa +Oall -Wl,-a,archive ...
</PRE>
This makes <CODE>cc</CODE> spend a <em>lot</em> of time on compilation, but
the resulting code is twice as fast as that generated by <CODE>gcc -O3</CODE>,
not to mention <CODE>cc -Aa -O</CODE> which is even slower.

<P>
On the PII, the best performance seem to be obtained using
<PRE>
  gcc -O3 ...
</PRE>

<P>
Using the fastest compilations options on both machines, the HP is about 50%
faster than the PII.

<h4>Update</h4>

It is possible to obtain better results on the PC by using other
compilers. The EGCS compiler (a gcc variant) produces about 20% faster code
than stock gcc. Even better results can be obtained using PGCC, the
pentium-optimized EGCS compiler, but some versions of PGCC have bugs that may
lead to incorrect results. See <a href="compiler-bugs.html">this note</a> for
comparison and details.

<hr><address>
Kristian Nielsen
&lt;<a href="mailto:kristian.nielsen@risoe.dk">kristian.nielsen@risoe.dk</a>&gt; /
<!-- hhmts start -->
Sep  3, 1998.
<!-- hhmts end -->
</address>
</body></html>
