<html><head>
<title>Graphical Debugging in McStas</title>
<LINK REV="made" HREF="mailto:kristian.nielsen@risoe.dk">
</head>

<body>

<h1>Graphical Debugging in McStas</h1>

<P>
This page describes a new facility for doing graphical debugging of instrument
simulations created with McStas. A schematic diagram of the instrument is
drawn, and the path of each neutron as it passes through the instrument is
plotted. The following are two examples (of a triple-axis spectrometer; these
pictures clearly show a problem in the monochromator (orange circle)).
</P>
<P ALIGN=CENTER><img src="ex1.gif"></P>
<P ALIGN=CENTER><img src="ex2.gif"></P>

<P>
The instrument is shown as the red crosshairs connected with red lines. The
components appear as circles of different colours. The neutron path is shows
in green. A small dot in the same color as a component indicates the point
where the neutron leaves that component. A new neutron is shown after a
mouseclick or a keypress.

<P>
The graphic display is obtained by creating a special instrument simulation
that produces debugging output about neutron states etc. The output of this
simulation is then fed into the program "display", which reads the information
and converts it into graphics using PGPLOT.

<P>
The instrument simulation with debugging output is obtained by defining the
preprocessor macro DEBUG when compiling. For example
<PRE>
gcc -o instr -DDEBUG instr.c mcstas-r.c -lm
</PRE>
It may be instructive to run the generated simulation <CODE>instr</CODE> to
see the kind of output produced.

<P>
To get the graphics display, the output of <CODE>instr</CODE> is fed into
<CODEdisplay</CODE> using a Unix pipe:
<PRE>
./instr | ./display
./instr | ./display multi
</PRE>
(the latter "multi" option views the instrument from three directions).

<P>
A hint when debugging instruments is to use another pipe to avoid the tedious
entering of instrument parameters for each run. For example,
<PRE>
echo 0.12 0.45 1.2 0.123 1.5 0.1 | ./instr | ./display
</PRE>
(yes, angles are currently entered in radians, but this will probably
change!). This is also useful to set up a whole scan in a simple shell script.


<hr><address>
Kristian Nielsen
&lt;<a href="mailto:kristian.nielsen@risoe.dk">kristian.nielsen@risoe.dk</a>&gt; /
<!-- hhmts start -->
Oct  2, 1998.
<!-- hhmts end -->
</address>
</body></html>
