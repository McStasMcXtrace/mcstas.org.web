/***************************************************************************
*
* Current D3 simulations
*
* Written by Aidy, ILL, June 2000
* 6/6/2000 Source and Beam Guide Collimation
* 17/7/2000 MonoChromator 
* 
*
*
***************************************************************************/


DEFINE INSTRUMENT d3(InPileColl_Vert,InPileColl_Hori,slits_xmin,slits_xmax,slits_ymin,slits_ymax,mono_mosaic,mono_mosaic1,mono_mosaic2)

TRACE
  COMPONENT arm1=Arm()
  AT (0,0,0) ABSOLUTE

  COMPONENT source = Source_flat_lambda(
	radius = 0.05,
	dist =6.97,
	xw = 0.050, yh = 0.20, 
	lambda_0 =0.84,
	d_lambda = 0.1)
  AT (0,0,0) RELATIVE arm1

COMPONENT  Coll1= Guide(
    w1 = 0.05, h1 = 0.15, w2 = 0.05, h2 = 0.15, l = 1.07, R0 = 0.0,
    Qc = 0.1, alpha = 1.0, m = 0, W = .1 )
  AT (0, 0, 2.409) RELATIVE arm1
 


 COMPONENT MONITOR1 = PSD_monitor(
        xmin=-0.075,
        xmax=0.075,
        ymin=-0.075,
        ymax=0.075,
        nx=100,
        ny=100,
        filename="mon1.dat")
  AT (0,0,1.07) RELATIVE Coll1
  
  
COMPONENT Coll2 = Guide(
    w1 = 0.114, h1 = 0.114, w2 = 0.114, h2 = 0.114, l = 0.488 , R0 = 0.0,
    Qc = 0.1, alpha = 1.0, m = 0, W = 0.1 )
  AT (0, 0, 1.07) RELATIVE Coll1

 COMPONENT MONITOR2 = PSD_monitor(
        xmin=-0.075,
        xmax=0.075,
        ymin=-0.075,
        ymax=0.075,
        nx=100,
        ny=100,
        filename="mon2.dat")
  AT (0,0,0.488) RELATIVE Coll2  
 

COMPONENT  Coll3= Guide(
    w1 = InPileColl_Vert, h1 = InPileColl_Hori,
    w2 = InPileColl_Vert, h2 = InPileColl_Hori, l = 0.449, R0 = 0.0 ,
    Qc = 0.1 , alpha =1.0 , m =0 , W = 0.1)
  AT (0, 0, .488) RELATIVE Coll2


  COMPONENT MONITOR3 = PSD_monitor(
        xmin=-0.075,
        xmax=0.075,
        ymin=-0.075,
        ymax=0.075,
        nx=100,
        ny=100,
        filename="mon3.dat")
  AT (0,0,0.449) RELATIVE Coll3  

  COMPONENT arm2 = Arm() 
  AT (0,0,5.992) RELATIVE source 
  ROTATED (0,6.97,0) RELATIVE source

COMPONENT Mon_mono = PSD_monitor(
    xmin = -0.05, xmax = 0.05, ymin = -0.075, ymax = 0.075,nx=100,ny=100,filename="mono_mon.dat")
  AT (0, 0, 0) RELATIVE arm2

  COMPONENT mono = Single_crystal(
    reflections = "mono1.ref", xwidth = 0.05, yheight = 0.04,
    zthick = 0.01, delta_d_d = 0.1, mosaic = 10.0,
    mosaic_h = 0.0, mosaic_v = 0.0, mosaic_n = 0.0, ax = 1.74,
    ay = 0, az = 0, bx = 0, by = 1.74, bz = 0, cx = 0, cy = 0,
    cz = 1.74, p_transmit = 0, absorbtion = 0, incoherent = 0)
  AT (0,0,0) RELATIVE  arm2
 

  COMPONENT arm3 = Arm() 
  AT (0,0,0) RELATIVE arm2 
  ROTATED (0,16.8,0) RELATIVE arm1


COMPONENT Cara = Guide(
    w1 = 0.05, h1 = 0.05, w2 = 0.05, h2 = 0.05, l = 0.5, R0 = 0.0,
    Qc = 0.1 , alpha =1 , m =0 , W =0.1 )
  AT (0, 0, 0.6) RELATIVE arm3
  
 
  COMPONENT EMON= E_monitor(
        xmin=-0.075,
        xmax=0.075,
        ymin=-0.075,
        ymax=0.075,
        Emin=10,
        Emax=200,
        nchan=100,
        filename="emon1.dat")
  AT (0,0,1.99) RELATIVE arm3  

  COMPONENT MONITOR4 = PSD_monitor(
        xmin=-0.075,
        xmax=0.075,
        ymin=-0.075,
        ymax=0.075,
        nx=100,
        ny=100,
        filename="mon4.dat")
  AT (0,0,1.99) RELATIVE arm3 


COMPONENT  slit = Slit(
    xmin = slits_xmin, xmax = slits_xmax, ymin = slits_ymin, ymax = slits_ymax)
  AT (0, 0, 2.0) RELATIVE arm3
 

 COMPONENT MONITOR5 = PSD_monitor(
        xmin=-0.075,
        xmax=0.075,
        ymin=-0.075,
        ymax=0.075,
        nx=100,
        ny=100,
        filename="mon5.dat")
  AT (0,0,2.01) RELATIVE arm3  

 COMPONENT arm4 = Arm() 
  AT (0,0,2.4) RELATIVE arm3
  ROTATED (0,6.97,0) RELATIVE arm3 

 COMPONENT mono1=  Single_crystal(
  reflections="mono.ref", xwidth = 0.05, yheight = 0.04,
    zthick = 0.01, delta_d_d = 0.1, mosaic = 10.0,
    mosaic_h = 0.0, mosaic_v = 0.0, mosaic_n = 0.0, ax = 1.74,
    ay = 0, az = 0, bx = 0, by = 1.74, bz = 0, cx = 0, cy = 0,
    cz = 1.74, p_transmit = 0, absorbtion = 0, incoherent = 0)
  AT (0,0,0) RELATIVE  arm4

  COMPONENT target=V_sample(
            radius_i=0.008,
            radius_o=0.012,
            h=0.015,
            focus_r=0,
            pack=1,
            target_x=0,
            target_y=0,
            target_z=1)
  AT (0,0,2.4) RELATIVE arm4

 COMPONENT PSD_4pi= PSD_monitor_4PI(
            radius=0.05,
            nx=101,
            ny=51,
            filename="vanadium.psd")
  AT (0,0,0) RELATIVE target

END










