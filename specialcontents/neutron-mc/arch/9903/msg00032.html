<P><strong><blink>This archive web page is obsolete!</blink></strong> 
<P>Please refer to the new <a href="/pipermail/neutron-mc">mailman<a> archive!


<!-- MHonArc v2.1.0 -->
<!--X-Subject: velocity selector -->
<!--X-From: Peter Link <Peter_Link@physik.tu&#45;muenchen.de> -->
<!--X-Date: Tue, 23 Mar 1999 09:24:49 +0100 -->
<!--X-Message-Id: 36F74FD1.796AEE72@physik.tu&#45;muenchen.de -->
<!--X-ContentType: multipart/mixed -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML//EN">
<html>
<head>
<title>velocity selector</title>
<link rev="made" href="mailto:Peter_Link@physik.tu-muenchen.de">
</head>
<body bgcolor="white">
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<hr>
[<A HREF="msg00002.html">Date Prev</A>][<A HREF="msg00033.html">Date Next</A>]
<a href="index.html#00032">[Chronological]</a>
<a href="threads.html#00032">[Thread]</a>
<a href="/cgi-bin/wilma/neutron-mc">[Top]</a>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<H1>velocity selector</H1>
<HR>
<!--X-Subject-Header-End-->
<UL>
<LI><strong>To</strong>: <strong><A HREF="mailto:kristian.nielsen@risoe.dk">kristian.nielsen@risoe.dk</A></strong></LI>
<LI><strong>Subject</strong>: <strong>velocity selector</strong></LI>
<LI><strong>From</strong>: <strong>Peter Link &lt;<A HREF="mailto:Peter_Link@physik.tu-muenchen.de">Peter_Link@physik.tu-muenchen.de</A>&gt;</strong></LI>
<LI>Date: Tue, 23 Mar 1999 09:24:49 +0100</LI>
<LI>Organization: IPC Universit&auml;t G&ouml;ttingen (Au&szlig;enstelle Garching)</LI>
</UL>
<!--X-Head-Body-Sep-Begin-->
<HR>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<PRE>
Hi Kristian,
here is another component for the McStas comunity.
Although I'm aware that in principle one can simulate the function of a
mechanical velocity selector with some filter component I tried to
create a selector component that is rather close to reality. I tested it
with a configuration where I have analytic calculation to compare to and
to me it seems O.K.
The principle is quite correctly explained in 
H. Friedrich et al.; Physica B 156&amp;157 (1989) 547
May be some SANS people are interested in this comp too.
Have fun, best regards Peter.
-- 
******************************************
Dr. P. Link
IPC Uni Göttingen
Außenstelle Garching
Neue Forschungs- Neutronenquelle Garching
ZBE- FRM II- Bau
85747 Garching

Tel. 089 2891 4622
Fax. 089 2895 4622
mailto: plink@physik.tu-muenchen.de
******************************************

</PRE>
<PRE>
/*******************************************************************************
*
*         McStas component for version 1.0, released October 26, 1998
*         Peter Link, IPC University of Göttingen
*
* Component: Selector
*
* Written by: Peter Link  MARCH 1999
*
* velocity selector (helical lamella type)
* 
* 
*
* INPUT PARAMETERS:
*
* xmin:        Lower x bound (m)
* xmax:        Upper x bound (m)
* ymin:        Lower y bound (m)
* ymax:        Upper y bound (m)
* len:         rotor length  (m)
* num:         number of spokes/lamella (1)
* width:       width of spokes at beam-center (m)
* radius:      radius of beam-center (m)
* alfa:        angle of torsion (deg)
* feq:         frequency of rotation(1/s)
* 
*******************************************************************************/


DEFINE COMPONENT Selector
DEFINITION PARAMETERS (xmin, xmax, ymin, ymax, len, num,width,radius,alfa,feq)
SETTING PARAMETERS ()
STATE PARAMETERS (x,y,z,vx,vy,vz,t,s1,s2,p)
TRACE
%{
    double E;
    double dt;
	double open_angle,closed_angle,n_angle_in,n_angle_out;
	double sel_phase;
    
    PROP_Z0;
    E=VS2E*(vx*vx+vy*vy+vz*vz);
    if (x&lt;xmin || x&gt;xmax || y&lt;ymin || y&gt;ymax)
      ABSORB;                                  /* because outside frame */
    dt = len/vz;
    /* get phase angle of selector rotor as MonteCarlo choice 
	   only the free space between two neighboring spokes is taken
	   p is adjusted to transmission for parallel beam
    */
	n_angle_in = atan2( x,y+radius)*RAD2DEG;
	closed_angle = width/radius*RAD2DEG;
	open_angle = 360/num-closed_angle;
	sel_phase = open_angle*rand01();
	p *= (open_angle/(closed_angle+open_angle));
	
	PROP_DT(dt);

    if (x&lt;xmin || x&gt;xmax || y&lt;ymin || y&gt;ymax)
      ABSORB;                                  /* because outside frame */
    /* now let's look whether the neutron is still
	 between the same two spokes or absorbed meanwhile */
    
	n_angle_out = atan2(x,y+radius)*RAD2DEG;  /* neutron beam might be divergent */
    
	sel_phase = sel_phase + feq*dt*360 - alfa;  /* rotor turned, but spokes are torsaded */ 

	if (n_angle_out&lt;(n_angle_in-sel_phase) || n_angle_out&gt;(n_angle_in-sel_phase+open_angle) )
	    ABSORB;              /* because must have passed absorber */
     
    
%}
END

</PRE>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<HR>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<LI>Prev by Date:
<STRONG><A HREF="msg00002.html">Re: order of moving and rotating</A></STRONG>
</LI>

<LI>Next by Date:
<STRONG><A HREF="msg00033.html">Thanks!</A></STRONG>
</LI>

<li>Index(es):
<ul>
<li><a href="index.html#00032"><strong>Chronological</Strong></a></li>
<li><a href="threads.html#00032"><strong>Thread</strong></a></li>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
</BODY>
</HTML>
