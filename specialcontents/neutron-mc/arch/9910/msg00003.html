<P><strong><blink>This archive web page is obsolete!</blink></strong> 
<P>Please refer to the new <a href="/pipermail/neutron-mc">mailman<a> archive!


<!-- MHonArc v2.1.0 -->
<!--X-Subject: Re: kw_monitor -->
<!--X-From: Kristian Nielsen <kristian.nielsen@risoe.dk> -->
<!--X-Date: 5 Oct 1999 13:00:57 +0200 -->
<!--X-Message-Id:  -->
<!--X-ContentType: text/plain -->
<!--X-Reference-Id: 37F9C767.B04EDB5A@ill.fr -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML//EN">
<html>
<head>
<title>Re: kw_monitor</title>
<link rev="made" href="mailto:kristian.nielsen@risoe.dk">
</head>
<body bgcolor="white">
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<hr>
[<A HREF="msg00002.html">Date Prev</A>][<A HREF="msg00013.html">Date Next</A>]
<a href="index.html#00003">[Chronological]</a>
<a href="threads.html#00003">[Thread]</a>
<a href="/cgi-bin/wilma/neutron-mc">[Top]</a>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<H1>Re: kw_monitor</H1>
<HR>
<!--X-Subject-Header-End-->
<UL>
<LI><strong>To</strong>: <strong><A HREF="mailto:farhi@ill.fr">farhi@ill.fr</A></strong></LI>
<LI><strong>Subject</strong>: <strong>Re: kw_monitor</strong></LI>
<LI><strong>From</strong>: <strong>Kristian Nielsen &lt;<A HREF="mailto:kristian.nielsen@risoe.dk">kristian.nielsen@risoe.dk</A>&gt;</strong></LI>
<LI>Date: 5 Oct 1999 13:00:57 +0200</LI>
<LI>In-reply-to: &lt;<A HREF="msg00002.html">37F9C767.B04EDB5A@ill.fr</A>&gt; (message from Farhi on Tue, 05 Oct1999 11:39:51 +0200)</LI>
</UL>
<!--X-Head-Body-Sep-Begin-->
<HR>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<PRE>
&gt; Date: Tue, 05 Oct 1999 11:39:51 +0200
&gt; From: Farhi &lt;farhi@ill.fr&gt;

&gt; Hy Kristian,

&gt; Concerning the kw_monitor, I saw you installed it in the unofficial
&gt; additions to McStas. It's great, thanks. Anyway, I modified a line at
&gt; the begining in order to be able to use more than one of these monitors
&gt; in one instrument definition. Could you update this ?

I have now put the updated component on the page.

&gt; I'm still on the optimizer. I got some problems in computing the adapted
&gt; 'pi' probability.
&gt; For some neutrons, it becomes very big, that makes spikes on instruments
&gt; monitors.
&gt; The neutrons responsible for this are those whose efficiency is low (the
&gt; optimized source should emit few of those, thus their weight is high).

Ah! Yes, I also found the hard way that a lot of care is needed when
designing the strategy for optimizing the neutron emission when I did my
adaptive source component.

I think I use a slightly different strategy from yours, maybe it can
serve as inspiration. I do not think in terms of optimizing the number
of neutrons in the detector; rather I think in terms of minimizing the
statistical error in the detector. The statistical error depends not
only on the number of neutrons, but also on the variance of the neutron
weights in the detector. The lower the variance, the lower the
statistical error.

Therefore, the optimization criteria for the adaptive source is to make
the neutron weights about equal at the point of optimization. So if a
neutron reaches the optimization point with lower-than-avarage weight
(or if it is absorbed-&gt;weight equals zero), the probability for those
initial parameters is reduced, causing a higher initial weight. And vice
versa, a neutron with a very high weight will cause an increased
probability of its initial parameters, and hence a lower initial weight.

Ok, maybe in my case things are slightly different, since I actually
change the initial parameter probabilities after every neutron (but only
a little bit each time).

You mentioned spikes on instrument monitors, and I was not quite sure
what you meant. I do see these spikes sometimes with my source. For
example if I have a gaussian energy spectrum reflected from a
monochromator, and optimize the flux on the sample, the optimization
will minimize the statistical error on the value of the total flux. This
optimum is obtained by spending most of the computational effort on the
center of the energy spectrum, where the neutron weights are large, and
less on the tails of the spectrum. Thus the errors in the tails of the
energy spectrum will be relatively large, possibly causing spikes in an
energy monitor, but the error on the integrated flux will be small. In
case one is especially interested in the tails, one should use an
optimization criteria that reflects this fact.

Maybe we should try to set up the same simulation with both yours and my
optimizer and compare the results, that would probably be instructive.
What instrument are you using as benchmark? The "in14_6.instr" you sent me?

 - Kristian.




</PRE>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<HR>
<!--X-Follow-Ups-End-->
<!--X-References-->
<UL><LI><STRONG>References</STRONG>:
<UL>
<LI><STRONG><A NAME="00002" HREF="msg00002.html">kw_monitor</A></STRONG>
<UL><LI><EM>From:</EM> Farhi &lt;farhi@ill.fr&gt;</LI></UL></LI>
</UL></LI></UL>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<LI>Prev by Date:
<STRONG><A HREF="msg00002.html">kw_monitor</A></STRONG>
</LI>

<LI>Next by Date:
<STRONG><A HREF="msg00013.html">Re: kw_monitor</A></STRONG>
</LI>

<li>Index(es):
<ul>
<li><a href="index.html#00003"><strong>Chronological</Strong></a></li>
<li><a href="threads.html#00003"><strong>Thread</strong></a></li>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
</BODY>
</HTML>
