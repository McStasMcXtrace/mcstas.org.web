<P><strong><blink>This archive web page is obsolete!</blink></strong> 
<P>Please refer to the new <a href="/pipermail/neutron-mc">mailman<a> archive!


<!-- MHonArc v2.1.0 -->
<!--X-Subject: Re: First tries using McStas -->
<!--X-From: Kristian Nielsen <kristian.nielsen@risoe.dk> -->
<!--X-Date: Fri, 06 Nov 1998 09:36:17 +0100 -->
<!--X-Message-Id: 01J48MDF2ZDK8WWAUI@risoe.dk -->
<!--X-ContentType: text/plain -->
<!--X-Reference-Id: 13889.54936.150165.28077@obiwan.kri.physik.uni&#45;muenchen.de -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML//EN">
<html>
<head>
<title>Re: First tries using McStas</title>
<link rev="made" href="mailto:kristian.nielsen@risoe.dk">
</head>
<body bgcolor="white">
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<hr>
[<A HREF="msg00003.html">Date Prev</A>][<A HREF="msg00012.html">Date Next</A>]
<a href="index.html#00004">[Chronological]</a>
<a href="threads.html#00004">[Thread]</a>
<a href="/cgi-bin/wilma/neutron-mc">[Top]</a>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<H1>Re: First tries using McStas</H1>
<HR>
<!--X-Subject-Header-End-->
<UL>
<LI><strong>To</strong>: <strong><A HREF="mailto:artus@obiwan.kri.physik.uni-muenchen.de">artus@obiwan.kri.physik.uni-muenchen.de</A></strong></LI>
<LI><strong>Subject</strong>: <strong>Re: First tries using McStas</strong></LI>
<LI><strong>From</strong>: <strong>Kristian Nielsen &lt;<A HREF="mailto:kristian.nielsen@risoe.dk">kristian.nielsen@risoe.dk</A>&gt;</strong></LI>
<LI>Date: Fri, 06 Nov 1998 09:36:17 +0100</LI>
<LI>In-reply-to: &lt;13889.54936.150165.28077@obiwan.kri.physik.uni-muenchen.de&gt;(artus@obiwan.kri.physik.uni-muenchen.de)</LI>
</UL>
<!--X-Head-Body-Sep-Begin-->
<HR>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<PRE>
&gt; Dear Kristian,
&gt; 
&gt; in the last days since our return from Denmark I've installed your
&gt; program McStas on my machine here. Right now I'm trying to get my
&gt; first "instrument" running. I have some 'beginners problems' and now allow
&gt; myself to ask for help.
&gt; I wanted to simulate a simple straight neutron guide with m=2 for left 
&gt; and right faces and m=3 for top and bottom faces. But the component
&gt; Guide only allows one kind of coating. It is not quite clear to me
&gt; from the manual how to build such a guide out of four Mirror
&gt; components. The manual says that Mirrors can be used to assemble a
&gt; guide but it says also that a Mirror lies in the xy-plane. Wouldn't
&gt; one need Mirrors lying parallel to the z-axis to build a guide? May be 

You need to rotate the mirror appropriately. For the top and bottom,
rotate around the X axis. For the sides, rotate around the Y axis. (And
I need to add this info to the manual!). You must take care to use
mirrors that are short enough that each neutron cannot hit a single
mirror more than once.

This is a simple example (not fully tested):

------------------------------------------------------------------------
/* 4cm by 10cm, 1m long guide build from mirrors. */

COMPONENT guide = Axis()
  AT (0,0,1.5) RELATIVE source

COMPONENT mirrorh1 = Mirror(xlength = 0.04, yheight = 1.00, m = 3,
	Qc=0.02, W=0.0033, alpha=6.49, R0=1)
     AT (-0.02,-0.05,0) RELATIVE guide
     ROTATED (90,0,0) RELATIVE guide

COMPONENT mirrorh2 = Mirror(xlength = 0.04, yheight = 1.00, m = 3,
	Qc=0.02, W=0.0033, alpha=6.49, R0=1)
     AT (-0.02,0.05,0) RELATIVE guide
     ROTATED (90,0,0) RELATIVE guide

COMPONENT mirrorv1 = Mirror(xlength = 1.00, yheight = 0.1, m = 2,
	Qc=0.02, W=0.0033, alpha=6.49, R0=1)
     AT (-0.02,-0.05,0) RELATIVE guide
     ROTATED (0,90,0) RELATIVE guide

COMPONENT mirrorv2 = Mirror(xlength = 1.00, yheight = 0.1, m = 2,
	Qc=0.02, W=0.0033, alpha=6.49, R0=1)
     AT (0.02,-0.05,0) RELATIVE guide
     ROTATED (0,90,0) RELATIVE guide
------------------------------------------------------------------------

&gt; the use of different coatings within the same guide can be implemented 
&gt; within the Guide component in some future release?

I have added it on my "ToDo" list. You might want to try modifying the
guide component yourself, it should not be difficult. What you need to
do is:

1. Copy the file "Guide.comp" into your directory as "Guide2.comp" and
edit the new file as follows:
2. Change the name of the component from "Guide" to "Guide2":

    DEFINE COMPONENT Guide2

3. Replace the "m" definition parameter with two others, "mh" and
   "mv":

    DEFINITION PARAMETERS (w1, h1, w2, h2, l, R0, Qc, alpha, mh, mv, W)

4. Look in the calculations to see that the variable "i" is set to 1 or
2 for intersection with vertical mirrors, and 3 or 4 for horizontal
mirrors. Now find the calculation of the reflectivity and change it to
use mv if i &lt;= 2, and mh otherwise:

    double arg = (q - (i &lt;= 2 ? mv : mh)*Qc)/W;

That should be all! You can now use "Guide2" instead of "Guide" using
"mh" and "mv" for horizontal and vertical m-value. I have put up a
version of Guide with these modifications on the Web server that you may
download from

  <A HREF="http://elu-alf-2.risoe.dk/~elu-krni/mcstas/support/misc/Guide2.comp">http://elu-alf-2.risoe.dk/~elu-krni/mcstas/support/misc/Guide2.comp</A>

&gt; To make things easier I tried to set up the instrument with m=2 for
&gt; all faces. But trying to compile it with McStas ends with:
&gt; 
&gt; artus@obiwan:/home/artus/mcstas/resi1 &gt; mcstas resi1.instr 
&gt; parse error, expecting `"AT"' at line 37.
&gt; Errors encountered during parse.
&gt; artus@obiwan:/home/artus/mcstas/resi1 &gt; 
&gt; 
&gt; The AT is expected in the END line? 
&gt; I cannot find any error in resi1.instr:

The reason for the strange error message is that you have an
unterminated comment:

&gt;         dE = 1.0)       /* =0.99394A - 1.00617A 
                                         here -&gt; ^^^

So the rest of the file is just a comment as far as McStas is
concerned :-(

Once you fix this, you also need to separate the arguments to "Guide"
with commas:

&gt; COMPONENT guide1 = Guide(
&gt; 	w1 = 0.020
&gt; 	h1 = 0.060
&gt; 	w2 = 0.020
&gt; 	h2 = 0.060
&gt; 	l = 11.500
&gt; 	R0 = 1.0
&gt; 	Qc = 0.0214
&gt; 	alpha = 5.617
&gt; 	m = 2
&gt; 	W = 0.0033)
&gt;   AT (0,0,2) RELATIVE a1 

This should be

COMPONENT guide1 = Guide(
	w1 = 0.020,
	h1 = 0.060,
	w2 = 0.020,
	h2 = 0.060,
	l = 11.500,
	R0 = 1.0,
	Qc = 0.0214,
	alpha = 5.617,
	m = 2,
	W = 0.0033)
  AT (0,0,2) RELATIVE a1 

&gt; Furthermore I've tried to use mcdisplay on the example files but this
&gt; also ends with an error:
&gt; 
&gt; artus@obiwan:/home/artus/mcstas/example &gt; mcdisplay linup-1.instr 
&gt; Can't locate PGPLOT.pm in @INC (@INC contains: /usr/lib/perl5/i586-linux/5.00404 /usr/lib/perl5 /usr/lib/perl5/site_perl/i586-linux /usr/lib/perl5/site_perl .) at /usr/local/bin/mcdisplay line 6.
&gt; BEGIN failed--compilation aborted at /usr/local/bin/mcdisplay line 6.
&gt; artus@obiwan:/home/artus/mcstas/example &gt; 

You need to also install PgPerl, which is an interface that allows perl
programs to use pgplot. PgPerl is included on the CD in the file

    external/PGPLOT-2.11.tar.gz

&gt; Thank you very much for your help and

You are welcome! If you have any further questions, just mail me again
and I will do my best to help.

 - Kristian.




</PRE>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<HR>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<LI>Prev by Date:
<STRONG><A HREF="msg00003.html">First tries using McStas</A></STRONG>
</LI>

<LI>Next by Date:
<STRONG><A HREF="msg00012.html">Re: First tries using McStas</A></STRONG>
</LI>

<li>Index(es):
<ul>
<li><a href="index.html#00004"><strong>Chronological</Strong></a></li>
<li><a href="threads.html#00004"><strong>Thread</strong></a></li>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
</BODY>
</HTML>
