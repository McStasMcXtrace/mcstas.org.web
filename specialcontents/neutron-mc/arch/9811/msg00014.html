<P><strong><blink>This archive web page is obsolete!</blink></strong> 
<P>Please refer to the new <a href="/pipermail/neutron-mc">mailman<a> archive!


<!-- MHonArc v2.1.0 -->
<!--X-Subject: Re: First tries using McStas -->
<!--X-From: Kristian Nielsen <kristian.nielsen@risoe.dk> -->
<!--X-Date: Thu, 12 Nov 1998 15:13:27 +0100 -->
<!--X-Message-Id: 01J48MG2AFLS8WWAUI@risoe.dk -->
<!--X-ContentType: text/plain -->
<!--X-Reference-Id: 13896.13203.557267.61539@obiwan.kri.physik.uni&#45;muenchen.de -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML//EN">
<html>
<head>
<title>Re: First tries using McStas</title>
<link rev="made" href="mailto:kristian.nielsen@risoe.dk">
</head>
<body bgcolor="white">
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<hr>
[<A HREF="msg00011.html">Date Prev</A>][<A HREF="msg00017.html">Date Next</A>]
<a href="index.html#00014">[Chronological]</a>
<a href="threads.html#00014">[Thread]</a>
<a href="/cgi-bin/wilma/neutron-mc">[Top]</a>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<H1>Re: First tries using McStas</H1>
<HR>
<!--X-Subject-Header-End-->
<UL>
<LI><strong>To</strong>: <strong><A HREF="mailto:artus@obiwan.kri.physik.uni-muenchen.de">artus@obiwan.kri.physik.uni-muenchen.de</A></strong></LI>
<LI><strong>Subject</strong>: <strong>Re: First tries using McStas</strong></LI>
<LI><strong>From</strong>: <strong>Kristian Nielsen &lt;<A HREF="mailto:kristian.nielsen@risoe.dk">kristian.nielsen@risoe.dk</A>&gt;</strong></LI>
<LI>Date: Thu, 12 Nov 1998 15:13:27 +0100</LI>
<LI>In-reply-to: &lt;13896.13203.557267.61539@obiwan.kri.physik.uni-muenchen.de&gt;(artus@obiwan.kri.physik.uni-muenchen.de)</LI>
</UL>
<!--X-Head-Body-Sep-Begin-->
<HR>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<PRE>
Hi Georg,

&gt; using your component Guide2 for different coatings for left/right and
&gt; top/bottom faces of a guide I have now a first set up which could be
&gt; compared to a calculation with the program Beamline written by Jeremy Cook.

Great!

&gt; Beamline is able to compute absolute fluxes. Is there any possibility
&gt; to calculate absolute fluxes with McStas?

Yes, computing absolute fluxes is possible. The tricky part is to get
the units right.Ian Anderson from ILL was here a couple of days before
the Workshop. Together we set up a simple simulation of the in14
instrument at ILL and computed the absolute flux at the sample position.

As the unit of measure for the flux at the source we use

  number of neutrons per square cm per solid angle in
  steradians per wavelength in Aangstroem: n/(cm*cm*st*AA).

The component Source_flat models a source that emits N neutrons in the
full 4PI solid angle, where N is the number of neutron histories
simulated. Therefore, if delta_lambda is the range of wavelengths
emitted from the source in AA and r is the radius of the source in cm,
we can compute the total flux of the source simulated by McStas as
follows:

    flux = N / (PI*r*r * 4PI * delta_lambda)

To compare with another source of flux flux', the intensities in the
detector computed by McStas should be multiplied by the factor
(flux'/flux). Together with Ian I modified the Source_flat component to
compute this factor, but it still needs some polishing. I will look at
it and send it to you when it is ready.

Note that the intensity in detectors in McStas is the sum of the
statistical weights of incident neutrons. The actual number of neutron
histories that reach the detector is not very meaningfull because of
inportance sampling etc.

&gt; Another possible comparison is the transmission. Within Beamline, 
&gt; the transmission is the number of neutrons detected divided by the
&gt; number of neutrons entering the first guide section. To calculate an
&gt; "equivalent" transmission with the output of McStas I divided the
&gt; value mon_I by the solid angle at the source and divided the resulting 
&gt; value by the number of started neutrons. Is that correct?

It would probably be simpler to place one monitor at the guide entrance
and one at the exit. The transmission is then the ratio between the
intensities in the two monitors, mon2_I/mon1_I. The monitor at the
entrance must have the same dimensions as the guide opening, of course.

You will probably also want to compare the formula for mirror
reflectivity that McStas uses (page 30 in the manual) with the one used
in your program. If they are different it might be difficult to compare
results directly.

&gt; At the moment I'm trying to compare the profiles. Unfortunately we
&gt; don't have MATLAB so I need a workaround. The spatial distribution of
&gt; neutrons at the detector is no problem. How can I get the angular
&gt; distribution with McStas?

You can use the angular divergence detector that Kim Lefmann just wrote
today (for a simulation of our RITA spectrometer). It computes the
intensity as a function of angular divergence. I have put it on our Web
Page at the URL

<A HREF="http://elu-alf-2.risoe.dk/~elu-krni/mcstas/support/misc/Divergence_monitor.comp">http://elu-alf-2.risoe.dk/~elu-krni/mcstas/support/misc/Divergence_monitor.comp</A>


&gt; missing. I've installed all packages (from the CD: PGPLOT, PDL,

I am a bit confused here. You say that you installed PGPLOT. Did you
install both pgplot5.2.tar.gz and PGPLOT-2.11.tar.gz? Both are needed
for mcdisplay to work.

Btw, for pgplot5.2.tar.gz, the optional C bindings must also be
installed. There should be a file "cpgdemo" that correctly displays a
few graphs when run.

When you install PGPLOT-2.11.tar.gz, after running "make", running
"make test" should correctly display some simple examples in a window.

&gt; Unquoted string "pgend" may clash with future reserved word at /usr/local/bin/mcdisplay line 293.
&gt; Useless use of a constant in void context at /usr/local/bin/mcdisplay line 293.
&gt; Undefined subroutine &amp;main::pgbegin called at /usr/local/bin/mcdisplay line 261.
&gt; artus@obiwan:/home/artus/mcstas/example &gt; 

This looks as if the PGPLOT calls (pgend, pgbegin and so on) are not
recognized by perl. This is a bit strange, given that perl apparently
now does find the pgplot &lt;-&gt; perl interface file "PGPLOT.pm". In your
first mail, you wrote that perl failed to find this file:

&gt; Can't locate PGPLOT.pm in @INC (@INC contains:
&gt; /usr/lib/perl5/i586-linux/5.00404 /usr/lib/perl5
&gt; /usr/lib/perl5/site_perl/i586-linux /usr/lib/perl5/site_perl .) at
&gt; /usr/local/bin/mcdisplay line 6.
&gt; BEGIN failed--compilation aborted at /usr/local/bin/mcdisplay line 6.

I assume that installing the PGPLOT-2.11.tar.gz package fixed this?
Anyway, it appears that it did not install properly. When you installed
PGPLOT-2.11.tar.gz, did the "make test" command run correctly and
display a window?

If I remove the "use PGPLOT;" line at the top of the mcdisplay file, I
get the exact same error messages you do. Did you by any chance modify
the mcdisplay file?

It is a bit unfortunate that getting the graphics runnig is so
difficult. Especially since future versions of McStas will have much
better graphics. If you are able to give me a login account on your
machine and want me to help, I can log in remotely and try to find out
what the problem is.

Hope this helps,

 - Kristian.




</PRE>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<HR>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<LI>Prev by Date:
<STRONG><A HREF="msg00011.html">Re: Windows McStas</A></STRONG>
</LI>

<LI>Next by Date:
<STRONG><A HREF="msg00017.html">Re: First tries using McStas</A></STRONG>
</LI>

<li>Index(es):
<ul>
<li><a href="index.html#00014"><strong>Chronological</Strong></a></li>
<li><a href="threads.html#00014"><strong>Thread</strong></a></li>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
</BODY>
</HTML>
