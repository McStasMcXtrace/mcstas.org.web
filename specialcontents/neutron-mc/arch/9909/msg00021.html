<P><strong><blink>This archive web page is obsolete!</blink></strong> 
<P>Please refer to the new <a href="/pipermail/neutron-mc">mailman<a> archive!


<!-- MHonArc v2.1.0 -->
<!--X-Subject: Re: Optimizing McStas -->
<!--X-From: Kristian Nielsen <kristian.nielsen@risoe.dk> -->
<!--X-Date: 23 Sep 1999 11:45:58 +0200 -->
<!--X-Message-Id:  -->
<!--X-ContentType: text/plain -->
<!--X-Reference-Id: 37E8F694.DCD2A6E8@ill.fr -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML//EN">
<html>
<head>
<title>Re: Optimizing McStas</title>
<link rev="made" href="mailto:kristian.nielsen@risoe.dk">
</head>
<body bgcolor="white">
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<hr>
[<A HREF="msg00027.html">Date Prev</A>][<A HREF="msg00028.html">Date Next</A>]
<a href="index.html#00021">[Chronological]</a>
<a href="threads.html#00021">[Thread]</a>
<a href="/cgi-bin/wilma/neutron-mc">[Top]</a>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<H1>Re: Optimizing McStas</H1>
<HR>
<!--X-Subject-Header-End-->
<UL>
<LI><strong>To</strong>: <strong><A HREF="mailto:farhi@ill.fr">farhi@ill.fr</A></strong></LI>
<LI><strong>Subject</strong>: <strong>Re: Optimizing McStas</strong></LI>
<LI><strong>From</strong>: <strong>Kristian Nielsen &lt;<A HREF="mailto:kristian.nielsen@risoe.dk">kristian.nielsen@risoe.dk</A>&gt;</strong></LI>
<LI>Date: 23 Sep 1999 11:45:58 +0200</LI>
<LI>In-reply-to: &lt;<A HREF="msg00027.html">37E8F694.DCD2A6E8@ill.fr</A>&gt; (message from Farhi on Wed, 22 Sep1999 17:32:36 +0200)</LI>
</UL>
<!--X-Head-Body-Sep-Begin-->
<HR>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<PRE>
&gt; Date: Wed, 22 Sep 1999 17:32:36 +0200
&gt; From: Farhi &lt;farhi@ill.fr&gt;

&gt; I'm really looking forward to see how you did implement your optimisation.

Good! The technique is actually quite complex, and I think that the code
is useless without documentation. So this is a very good oppertunity to
write this documentation that I have already put off for too long. I
will write something up on the plane-trip home to Copenhagen tonight.

&gt; Can you put your adaptator in front of any component (in case user wants to
&gt; optimize flux on sample or final detector for instance).

Yes (except that you put if after the component, and that it optimizes
for all non-absorbed neutrons, but that can easily be extended).

&gt; What kind of source is it (rectangular, flat... ?).

Yes.

&gt; I guess you included a minimum and maximum
&gt; weight, in order not to completely delete bad neutrons (who knows, they can
&gt; perhaps reach detector sometimes...).

Yes, in fact there are several issues like this, and a lot of care is
needed (the source component actually changes the adapted distribution
for every neutron emitted). The user can specify a minimum fraction for
neutrons.

&gt; You choosed to use a 3D matrix for sampling neutron characteristics. This is
&gt; ok, and enables to take correlated parameters into account.

Right. The main application for the correllation is that of a source
aiming at a monochromator; for given energy and position, only a single
divergence will allow Bragg reflection. I choose not to correlate with
the vertical because of a hunch that the resulting 5-D distribution
would end up too large. The problem is not so much one of memory, but
rather that the adaptive algorithm must have many samples in each bin in
order to learn correctly, so the number of bins should be much smaller
than the neutron history count.

&gt; I was rather thinking about :
&gt; 1- optimize x,y,vx,vy,vz and adapt p as required
&gt; 2- use separate 1D arrays for each state parameter (limits would be
&gt; determined in a 1st phase (say 5% of ncounts). This means that parameters are
&gt; considered completely independent. It's a choice, but it enables fast
&gt; sampling, and low memory cost for any parameter number to be optimized. I
&gt; think it's ok if the minimum weight for bad neutrons is not 0 (say 10 % of
&gt; bad neutrons are kept)
&gt; 3- a separate component from source and monitor. This would enable user to
&gt; select any kind of source, and optimize flux anywhere.
&gt; 4- bad neutrons would be ABSORBed, this would lead to a new source shot.

I think this sounds quite interesting, and would nicely complement what
I have. A special advantage is the fact that it is independent of the
particular source component modelled. I would encourage you to go on
with your idea, and I hope we can continue to discuss it! I am very open
to extending the McStas core in case this is useful for your work.

 - Kristian.




</PRE>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<HR>
<!--X-Follow-Ups-End-->
<!--X-References-->
<UL><LI><STRONG>References</STRONG>:
<UL>
<LI><STRONG><A NAME="00027" HREF="msg00027.html">Re: Optimizing McStas</A></STRONG>
<UL><LI><EM>From:</EM> Farhi &lt;farhi@ill.fr&gt;</LI></UL></LI>
</UL></LI></UL>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<LI>Prev by Date:
<STRONG><A HREF="msg00027.html">Re: Optimizing McStas</A></STRONG>
</LI>

<LI>Next by Date:
<STRONG><A HREF="msg00028.html">Re: Optimizing McStas</A></STRONG>
</LI>

<li>Index(es):
<ul>
<li><a href="index.html#00021"><strong>Chronological</Strong></a></li>
<li><a href="threads.html#00021"><strong>Thread</strong></a></li>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
</BODY>
</HTML>
